# ****트랜젝션(transaction)****

## 트랜젝션 이란?

데이터베이스의 상태를 변화시키기 위한 **작업 수행의 논리적 단위**

### 트랜젝션의 목적

데이터베이스 서버에 여러 개의 클라이언트가 동시에 액세스 하거나 응용프로그램이 갱신을 처리하는 과정에서 중단될 수 있는 경우 등 데이터 부정합을 방지하고자 할 때 사용한다

*예시

---

A ⇒ B (10000원 송금) # A 작업

잔고 A : 10000원 ⇒ 0원

**rollback O**

잔고A: 0원 ⇒ 10000원

---

B⇒ A (10000원 받음) # B 작업

잔고 B : 0원 ⇒ 10000원

**rollback X**

잔고B: 10000원 ⇒ 10000원 

---

### Why?

**두개의 분류된 작업 /**  A 작업에서 rollback 실행 시, **B작업에는 영향이 없음**.

### **`=⇒ 하나의 트랜잭션으로 묶여야 제대로 된 rollback 실행 가능.`**

### `=⇒ 즉, 데이터 부정합을 방지하기 위해 A와 B를 포괄하는 트렌젝션 설계 必`

### 트렌잭션의 성공 / 오류

성공 : **commit**
을 호출해서 수정 사항을 DB에 영구적으로 반영

실패 : **rollback**
을 호출해서 트랜젝션 내부의 모든 작업을 원상복구 시킨다.

⇒ **DBMS의 성능은 초당 트랜잭션의 실행 수** ( **TPS**: Transaction per second )로 측정

## 트랜젝션의 4가지 특성

트랜잭션이 안전하게 수행되기 위해서는 ACID 조건을 충족해야 함

### Atomicity(원자성)

트랜젝션 내부에서 실행된 작업들은 **모두 성공해서 commit**이 되거나, 

문제가 발생한다면 **rollback을 통해 모두 취소**되야 한다. 

`**⇒ 작업 중 일부분만 성공 할 수 없다.**` 

---

### Consistency(일관성)

**모든 트랜젝션은 일관성 있는 데이터베이스 상태를 유지해야 한다.**

**`⇒트랜젝션 전 후의 데이터베이스의 상태가 Correct State`**

Corret State란?

**도메인의 유효범위, 무결성 제약조건 등의 제약조건을 위배하지 않는 정상적인 상태**

---

### Isolation(고립성 or 격리성)

**하나의 트랜잭션 수행시 다른 트랜잭션의 작업이 끼어들지 못하도록 해야 한다.**

`**⇒트랜잭션 끼리는 서로를 간섭할 수 없다. 트랜잭션이 실행하는 도중에 변경한 데이터는 이 트랜잭션이 완료될 때까지 다른 트랜잭션이 참조하지 못하게 하는 특성**`

**하나의 트랜잭션이 A라는 계좌에서 작업을 하고 있을 경우**,

**다른 트랜잭션이 A계좌에 대해 참조하거나 관여할 수 없고 작업이 끝날 때까지 대기**해야 하는 것을 말한다.

**But, 이는 동시성 처리 성능을 매우 나쁘게 한다. 따라서 격리성의 수준을 여러 단계로 분류**

- [**READ UNCOMMITED](https://devjem.tistory.com/27#READ%--UNCOMMITED)**
- 상대방에 커밋 하지 않은 데이터를 읽을 수 있다.
- [**READ COMMITED](https://devjem.tistory.com/27#READ%--COMMITED)**
- 상대방이 커밋 한 데이터만 조회할 수 있다.
- [**REPEATABLE READ](https://devjem.tistory.com/27#REPEATABLE%--READ)**
- 한번 조회한 데이터는 트랜젝션 내에서 다시 조회해도 같은 데이터가 나오는게 보장된다.
- [**SERIALABLE](https://devjem.tistory.com/27#SERIALABLE)**
- 가장 엄격한 수준의 격리성이지만 동시성 처리에는 매우 약하다.

`데이터베이스들은 보통 동시성 처리가 중요하기 때문에 **READ COMMITED 수준의 격리성을 사용**`

---

### Durability(지속성)

**트랜잭션이 정상적으로 종료된 다음에는 영구적으로** 

**데이터베이스에 작업의 결과가 저장되어야 한다**

`⇒정상적으로 완료 혹은 부분 완료된 데이터는 DBMS가 책임지고 데이터베이스에 기록하는 성질`

이를 통해, 중간에 시스템 문제가 발생했을 때 데이터베이스 로그를 참고해서 성공했던 트랜젝션을 복구 할 수 있다.
